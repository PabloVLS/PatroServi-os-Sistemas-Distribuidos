<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Login Profissional - Patro Serviços</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" />
  <style>.login-container{min-height:100vh;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);} .login-card{background:#fff;border-radius:15px;box-shadow:0 10px 30px rgba(0,0,0,.1)}</style>
  <script src="./js/config.js"></script>
</head>
<body>
  <div class="login-container d-flex align-items-center justify-content-center py-5">
    <div class="container">
      <div class="row justify-content-center">
        <div class="col-md-6 col-lg-4">
          <div class="login-card p-4">
            <div class="text-center mb-4">
              <i class="bi bi-tools display-4 text-primary mb-3"></i>
              <h3 class="fw-bold text-primary">Acesso Profissional</h3>
              <p class="text-muted">Entre na sua conta</p>
            </div>
            <form onsubmit="handleLogin(event)">
              <div class="mb-3">
                <label class="form-label">Login</label>
                <div class="input-group">
                  <span class="input-group-text bg-light"><i class="bi bi-person text-muted"></i></span>
                  <input type="text" class="form-control" id="login" placeholder="seu_login" minlength="3" required />
                </div>
              </div>
              <div class="mb-4">
                <label class="form-label">Senha</label>
                <div class="input-group">
                  <span class="input-group-text bg-light"><i class="bi bi-lock text-muted"></i></span>
                  <input type="password" class="form-control" id="senha" placeholder="Sua senha" required />
                </div>
              </div>
              <button type="submit" class="btn btn-primary w-100 py-2 mb-3"><i class="bi bi-box-arrow-in-right me-2"></i>Entrar</button>
              <div class="text-center"><a href="./index.html" class="text-decoration-none"><i class="bi bi-arrow-left me-1"></i>Voltar</a></div>
            </form>
          </div>
        </div>
      </div>
    </div>
  </div>
  <script>
    function api(path){return `${window.API_BASE}${path}`;}
    async function handleLogin(event){
      event.preventDefault();
      const login=document.getElementById('login').value;const senha=document.getElementById('senha').value;
      const btn=event.target.querySelector('button');const t=btn.innerHTML;btn.innerHTML='<i class="bi bi-arrow-repeat spinner"></i> Entrando...';btn.disabled=true;
      try{
        const resp=await fetch(api('/api/usuarios/login'),{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({login,senha})});
        if(resp.ok){const data=await resp.json();try{sessionStorage.setItem('usuarioLogin',data.login);}catch(e){} try{sessionStorage.setItem('usuarioProfissionalId',data.profissionalId||'');}catch(e){} if(data.profissionalId){try{const perfResp=await fetch(api(`/api/profissionais/${data.profissionalId}/perfil`));if(perfResp.ok){const perf=await perfResp.json();if(perf.nome)sessionStorage.setItem('usuarioNome',perf.nome);if(perf.perfil&&perf.perfil.fotoPerfil)sessionStorage.setItem('usuarioFoto',perf.perfil.fotoPerfil);}}catch(e){console.warn('Não foi possível carregar perfil do profissional',e);}} location.href='./index.html';}
        else if(resp.status===401){alert('Login ou senha inválidos');}
        else{const tx=await resp.text();alert('Erro no login: '+tx);}
      }catch(e){console.error(e);alert('Falha de rede no login');}
      finally{btn.innerHTML=t;btn.disabled=false;}
    }
  </script>
</body>
</html>
